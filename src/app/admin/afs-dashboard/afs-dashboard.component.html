<div class="dashboard-page  font-base">
  <div class="dashboard-layout">

    <!-- Filters -->
    <div class="filters filters-top">
      <div class="reset-filter" (click)="resetFilters()">Reset Filter</div>

      <label>State</label>
      <div class="custom-dropdown">
        <input type="text" [(ngModel)]="stateSearchText" (input)="selectedState = ''; stateDropdownOpen = true"
          (focus)="stateDropdownOpen = true" placeholder="Search state..." class="state-search-box" />
        @if(stateDropdownOpen && filteredStates.length > 0) {
        <div class="dropdown-list scroll-box">
          @for(s of filteredStates; track $index) {
          <button class="dropdown-item" (click)="selectState(s)" [class.selected]="s._id === selectedState">
            {{ s.name }}
          </button>
          }
        </div>
        }
      </div>

      <label>Population Category</label>
      <select [(ngModel)]="selectedPopulation" (change)="onPopulationOrStateChange()">
        <option value="">Select population category</option>
        @for(p of filters.populationCategories; track $index){
        <option [value]="p">{{ p }}</option>
        }
      </select>

      <label class="filter-label">City</label>
      <input type="text" [(ngModel)]="citySearchText" placeholder="Search city..." class="city-search-box" />

      @if(selectedState && selectedPopulation)
      {
      <div>
        <div class="city-checkboxes scroll-box">
          <label *ngFor="let c of filteredCities" class="checkbox-item">
            <input type="checkbox" [value]="c.name" [checked]="selectedCities.includes(c.name)"
              (change)="toggleCitySelection(c.name, $any($event.target).checked)" />
            <span>{{ c.name }}</span>
          </label>
        </div>
      </div>
      }

      <label>Year</label>
      <select [(ngModel)]="selectedYear">
        <option value="">Select Year</option>
        @for(y of filters.years; track $index){
        <option [value]="y.name">{{ y.name }}</option>
        }
      </select>

      <label>Document Type</label>
      <div class="grouped-dropdown">
        @for(group of filters.documentTypes; track $index){
        <div>
          <div class="group-heading">{{ group.heading }}</div>
          @for(d of group.items; track $index){
          <div class="group-option">
            <label>
              <input type="radio" name="docType" [value]="d.key" [(ngModel)]="selectedDocType"
                (ngModelChange)="onDocTypeChange($event)" />
              {{ d.name }}
            </label>
          </div>
          }
        </div>
        }
      </div>

      @if(selectedDocType !== '16th_fc'){
      <div class="audited-radio-container radio-options">
        <label>
          <input type="radio" name="auditStatus" [(ngModel)]="isAudited" value="audited" />
          Audited
        </label>
        <label>
          <input type="radio" name="auditStatus" [(ngModel)]="isAudited" value="unAudited" />
          UnAudited
        </label>
      </div>
      }

      <button class="apply-btn" (click)="applyFilters()">Apply</button>
    </div>

    <div class="content-panel">
      <!-- Top Controls -->
      <div class="top-controls">
        <div class="metrics-box">
          <div class="metrics-section">
            <div class="metrics-item">
              Files Digitized: <span class="number">{{ globalMetrics.digitizedFiles }}</span>
            </div>
            <div class="metrics-item">
              Pages Digitized: <span class="number">{{ globalMetrics.digitizedPages }}</span>
            </div>
            <div class="metrics-item error">
              Files Failed: <span class="number">{{ globalMetrics.failedFiles }}</span>
            </div>
            <div class="metrics-item error">
              Pages Failed: <span class="number">{{ globalMetrics.failedFiles }}</span>
            </div>
            <div class="metrics-item success">
              Successful Digitization: <span class="number">{{ getGlobalSuccessRate() }}%</span>
            </div>
          </div>
        </div>

        <button class="download-btn" (click)="downloadExcel()">Download</button>
        <div class="top-actions">
          <button class="profile-icon" (click)="togglePopup()">üë§</button>
        </div>
      </div>

      <!-- Profile Popup -->
      @if (showPopup) {
      <div class="profile-popup">
        <div class="close-btn" (click)="togglePopup()">√ó</div>
        <div class="popup-content">
          <div class="avatar-large">üë§</div>
          <div><strong>Name:</strong> {{ fullName }}</div>
          <div><strong>Email:</strong> {{ email }}</div>
          <div><strong>Role:</strong> {{ role }}</div>
          <div><strong>Designation:</strong> {{ designation }}</div>
          <button class="logout-btn" (click)="logout()">Logout</button>
        </div>
      </div>
      }


      <div class="table-wrapper">
        <div class="main-content">

          @if(!filtersApplied){
          <div class="placeholder-section">
            <div>
              <h4>select filters on the left pane to see the files</h4>
            </div>
          </div>
          }

          @if(isLoading){
          <div class="loader-overlay">
            <div class="spinner"></div>
            <p>Loading data...</p>
          </div>
          }

          @if(isLoading){
          <div class="loader-overlay">
            <div class="spinner"></div>
            <p>Please wait...</p>
          </div>
          }

          @if(filtersApplied){
          <div class="file-results">
            <h3>Available Files</h3>
            <div class="table-container">
              <table class="afs-table">
                <thead>
                  <tr>
                    <th>
                      ALL <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" />
                    </th>
                    <th>State</th>
                    <th>City
                      <span class="sort-buttons">
                        <button (click)="sortByCity('asc')">‚¨ÜÔ∏è</button>
                        <button (click)="sortByCity('desc')">‚¨áÔ∏è</button>
                      </span>
                    </th>
                    <th>ULB Code
                      <span class="sort-buttons">
                        <button (click)="sortByULBCode('asc')">‚¨ÜÔ∏è</button>
                        <button (click)="sortByULBCode('desc')">‚¨áÔ∏è</button>
                      </span>
                    </th>
                    <th>PDF DOCUMENT</th>

                    <th>Form Status</th>
                    <th>
                      Digitize Status
                      <div class="status-filter">
                        <select [(ngModel)]="selectedDigitizeStatus" (change)="filterByDigitizeStatus()">
                          <option value="">All</option>
                          <option value="DIGITIZED">DIGITIZED</option>
                          <option value="FAILED">FAILED</option>
                          <option value="NOT DIGITIZED">NOT DIGITIZED</option>

                        </select>
                      </div>
                    </th>

                    <th>
                      Form Uploaded On

                      <div class="date-filter">
                        <button class="calendar-btn" (click)="openUploadedDatePopup()">
                          üìÖ
                        </button>

                        <!-- Date Range Popup -->
                        @if(showUploadedDatePopup){ <div class="popup-overlay">
                          <div class="popup-box">
                            <h3>Select Date Range</h3>

                            <!-- Inline Date Fields -->
                            <div class="date-fields">
                              <!-- Start Date -->
                              <mat-form-field appearance="outline">
                                <mat-label>Start Date</mat-label>
                                <input matInput [matDatepicker]="uploadedStartPicker" [(ngModel)]="uploadedStartDate"
                                  [matDatepickerFilter]="disableFutureDates" [max]="today"
                                  placeholder="Choose start date" />
                                <mat-datepicker-toggle matSuffix [for]="uploadedStartPicker"></mat-datepicker-toggle>
                                <mat-datepicker #uploadedStartPicker></mat-datepicker>
                              </mat-form-field>

                              <!-- End Date -->
                              <mat-form-field appearance="outline">
                                <mat-label>End Date</mat-label>
                                <input matInput [matDatepicker]="uploadedEndPicker" [(ngModel)]="uploadedEndDate"
                                  [matDatepickerFilter]="disableFutureDates" [min]="uploadedStartDate" [max]="today"
                                  placeholder="Choose end date" />
                                <mat-datepicker-toggle matSuffix [for]="uploadedEndPicker"></mat-datepicker-toggle>
                                <mat-datepicker #uploadedEndPicker></mat-datepicker>
                              </mat-form-field>
                            </div>

                            <!-- Validation error -->
                            @if(uploadedStartDate && uploadedEndDate && !isUploadedDateRangeValid()){
                            <div class="error">
                              Start date cannot be after End date
                            </div>
                            }

                            <!-- Actions -->
                            <div class="popup-actions">
                              <button class="ok-btn"
                                [disabled]="!uploadedStartDate || !uploadedEndDate || !isUploadedDateRangeValid()"
                                (click)="applyUploadedDateRange()">OK</button>
                              <button class="reset-btn" (click)="resetUploadedDateRange()">Reset</button>
                              <button class="close-btn" (click)="closeUploadedDatePopup()">Close</button>
                            </div>
                          </div>
                        </div>
                        }

                        <!-- Show chosen range -->
                        @if(uploadedStartDate && uploadedEndDate){ <div class="date-display">
                          {{ uploadedStartDate | date:'dd-MM-yyyy' }} to {{ uploadedEndDate | date:'dd-MM-yyyy' }}
                        </div>
                        }
                      </div>
                    </th>
                    <th>
                      Form Digitized On


                      <div class="date-filter">

                        <button class="calendar-btn" (click)="openDatePopup()">
                          üìÖ
                        </button>

                        <!-- Date Range Popup -->
                        <!-- Date Range Popup -->
                        @if(showDatePopup){ <div class="popup-overlay">
                          <div class="popup-box">
                            <h3>Select Date Range</h3>

                            <!-- Inline Date Fields -->
                            <div class="date-fields">
                              <!-- Start Date -->
                              <mat-form-field appearance="outline">
                                <mat-label>Start Date</mat-label>
                                <input matInput [matDatepicker]="startPicker" [(ngModel)]="digitizedStartDate"
                                  [matDatepickerFilter]="disableFutureDates" [max]="today"
                                  placeholder="Choose start date" />
                                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                                <mat-datepicker #startPicker></mat-datepicker>
                              </mat-form-field>

                              <!-- End Date -->
                              <mat-form-field appearance="outline">
                                <mat-label>End Date</mat-label>
                                <input matInput [matDatepicker]="endPicker" [(ngModel)]="digitizedEndDate"
                                  [matDatepickerFilter]="disableFutureDates" [min]="digitizedStartDate" [max]="today"
                                  placeholder="Choose end date" />
                                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                                <mat-datepicker #endPicker></mat-datepicker>
                              </mat-form-field>
                            </div>

                            <!-- Validation error -->
                            @if(digitizedStartDate && digitizedEndDate && !isDateRangeValid())
                            { <div class="error">
                              Start date cannot be after End date
                            </div>
                            }

                            <!-- Actions -->
                            <div class="popup-actions">
                              <button class="ok-btn"
                                [disabled]="!digitizedStartDate || !digitizedEndDate || !isDateRangeValid()"
                                (click)="applyDateRange()">OK</button>
                              <button class="reset-btn" (click)="resetDateRange()">Reset</button>
                              <button class="close-btn" (click)="closeDatePopup()">Close</button>
                            </div>
                          </div>
                        </div>
                        }



                        <!-- Show chosen range -->
                        @if(digitizedStartDate && digitizedEndDate){<div class="date-display">
                          {{ digitizedStartDate | date:'dd-MM-yyyy' }} to {{ digitizedEndDate
                          | date:'dd-MM-yyyy' }}
                        </div>
                        }
                      </div>


                    </th>
                    <th tabindex="-1">Request ID / Log</th>
                  </tr>
                </thead>
                <tbody>
                  @if(filteredFiles.length === 0){
                  <tr>
                    <td colspan="10" class="no-results">No results found within selected filters
                    </td>
                  </tr>
                  }
                  @for(file of filteredFiles; track $index){
                  <tr [ngClass]="{'active-row': activeRow === file}">
                    <td>
                      <input type="checkbox" [(ngModel)]="file.selected" (change)="updateSelection()" />
                    </td>

                    <td>{{ file.stateName }}</td>
                    <td>{{ file.cityName }}</td>
                    <td>{{ file.ulbCode }}</td>

                    <td>
                      <div class="content-wrapper1">
                        <div class="ulb-file">
                          @if(file.previewUrl){
                          <a [href]="file.previewUrl" target="_blank"
                            (click)="setActiveRow(file); $event.stopPropagation()">{{
                            file.fileName }}</a>
                          @if(file.pageCount !== undefined){
                          <div class="page-count">({{ file.pageCount }} pages)</div>
                          }
                          } @else if(file.fileUrl){
                          <a [href]="storageBaseUrl + file.fileUrl" target="_blank"
                            (click)="setActiveRow(file); $event.stopPropagation()">{{
                            file.fileName }}</a>
                          @if(file.pageCount !== undefined){
                          <div class="page-count">({{ file.pageCount }} pages)</div>
                          }
                          } @else {
                          {{ file.fileName }}
                          @if(file.pageCount !== undefined){
                          <div class="page-count">({{ file.pageCount }} pages)</div>
                          }
                          }
                        </div>

                        @if(file.extraFiles && file.extraFiles.length > 0){
                        <div class="afs-files">
                          @for(ef of file.extraFiles; track $index){
                          <div class="file-link afs-file">
                            <a [href]="ef.fileUrl" target="_blank"
                              (click)="setActiveRow(file); $event.stopPropagation()">{{
                              ef.fileName }}</a>
                            @if(ef.pageCount !== undefined){
                            <div class="page-count">({{ ef.pageCount }} pages)</div>
                            }
                          </div>
                          }
                        </div>
                        }

                        <div style="margin-top: -14px;">
                          <button class="upload-btn" style="margin-bottom: 4px;"
                            (click)="setActiveRow(file); triggerFileInput(file)">
                            {{ file.extraFiles && file.extraFiles.length > 0 ? 'Re-upload' :
                            'Upload' }}
                          </button>
                          <input type="file" accept="application/pdf" style="display: none"
                            (change)="handleFileUpload($event, file)" #fileInput
                            [attr.data-id]="file.cityName + file.ulbCode" />
                        </div>
                      </div>
                    </td>

                    <td>
                      <div class="digitize-status-wrapper">
                        <div class="digitize-block ulb-block">
                          {{ file.statusText }}
                        </div>
                        @if(file.extraFiles && file.extraFiles.length > 0){
                        <div class="digitize-block afs-block">N/A</div>
                        }
                      </div>
                    </td>

                    <td>
                      <div class="digitize-status-wrapper" style="margin-top: 30px;">
                        <div class="digitize-block ulb-block">
                          <!-- ULB Slot -->
                          @if (hasExcelFile(file, 'ULB')) {
                          DIGITIZED
                          @for (excel of getExcelFiles(file, 'ULB'); track excel) {
                          <a [href]="getFullExcelUrl(excel)" target="_blank">
                            excelfile.xlsx
                          </a>
                          }
                          } @else {
                          @if (hasFailedExcelFile(file, 'ULB')) {
                          <div style="color: red;">
                            FAILED
                          </div>
                          } @else {
                          <div>
                            NOT DIGITIZED
                          </div>
                          }
                          }
                        </div>


                        <div class="spacingup-2">
                          @if(file.extraFiles && file.extraFiles.length > 0)
                          {
                          <div class="digitize-block afs-block">
                            @if (hasExcelFile(file, 'AFS')) {
                            DIGITIZED
                            @for (excel of getExcelFiles(file, 'AFS'); track excel) {
                            <a [href]="getFullExcelUrl(excel)" target="_blank">
                              excelfile.xlsx
                            </a>
                            }
                            } @else {
                            @if (hasFailedExcelFile(file, 'AFS')) {
                            <div style="color: red;">
                              FAILED
                            </div>
                            } @else {
                            <div>
                              NOT DIGITIZED
                            </div>
                            }
                            }
                          </div>

                          }
                        </div>
                      </div>
                    </td>



                    <td>
                      <div class="digitize-status-wrapper" style="margin-top: 20px; margin-right: 12px;"
                        [ngClass]="{'single-block': !file.uploadedAt}">
                        @if(file.ulbSubmit){ <div class="digitize-block ulb-block">
                          {{ file.ulbSubmit | date: 'd/M/yyyy, h:mm a' }}
                        </div>
                        }
                        @if(!file.ulbSubmit){<div class="digitize-block ulb-block">
                          N/A
                        </div>
                        }

                        @if(file.uploadedAt){ <div class="digitize-block afs-block">
                          {{ file.uploadedAt | date: 'd/M/yyyy, h:mm a' }}
                        </div>
                        }
                      </div>
                    </td>



                    <td>
                      @if (file.excelFiles && file.excelFiles.length > 0) {
                      <div class="timestamp-wrapper" style="margin-top: 20px; margin-right: 15px;">
                        @for (excel of file.excelFiles; track excel) {
                        <div class="timestamp-block">
                          <span>
                            {{
                            excel && excel.digitizedAt
                            ? (excel.digitizedAt | date: 'd/M/yyyy, h:mm a')
                            : 'N/A'
                            }}
                          </span>
                        </div>
                        }
                      </div>
                      } @else {
                      <div class="digitize-status-wrapper single-block" style="margin-top: 30px;">
                        <div class="digitize-block ulb-block">N/A</div>
                      </div>
                      }
                    </td>




                    <!--                 
                    <td>
                      <button style="margin-bottom: 30px;" mat-button color="primary"
                        (click)="openLogs(file.excelFiles?.[0]?.requestId || '')">
                        View Logs
                      </button>
                    </td> -->
                    <td>
                      @if((file.excelFiles?.length ?? 0) > 0){ <div class="log-buttons-container">
                        <ng-container *ngFor="let excel of file.excelFiles">
                          <button mat-raised-button class="log-btn" [ngStyle]="{
          'background-color': excel.uploadedBy === 'AFS' ? '#28a745' : '#1976d2',
          color: 'white'
        }" (click)="openLogs(excel.requestId)">
                            View Logs ({{ excel.uploadedBy || 'Unknown' }})
                          </button>
                        </ng-container>
                      </div>
                      }

                      @if(!file.excelFiles || file.excelFiles.length === 0){ <div>
                        <span class="text-muted">No logs</span>
                      </div>
                      }
                    </td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
            @if(selectedFilesCount > 0) { <div class="selection-summary">
              <strong>{{ totalSelectedPages }} pages</strong> from
              <strong>{{ selectedFilesCount }} PDF file(s)</strong> selected to digitize

            </div>
            }

            <div>

              <button class="digitize-btn" (click)="openDigitizePopup()">Digitize</button>
            </div>
            <!-- Digitize Popup -->
            @if(showDigitizePopup){<div class="popup-overlay">
              <div class="popup-box">
                <h3>Confirm Digitization</h3>
                <p [innerHTML]="digitizePopupMessage"></p>

                @if(digitizeStatus === ''){<div>
                  <button class="proceed-btn" (click)="proceedDigitization()">Proceed</button>
                  <button class="cancel-btn" (click)="closeDigitizePopup()">Cancel</button>
                </div>}
                @if(digitizeStatus === 'processing'){<div class="loader-container">
                  <div class="spinner"></div>
                  <p style="margin-top: 10px; font-weight: bold;">Digitization in progress...</p>
                </div>
                }
                @if(digitizeStatus === 'done') {<div>
                  <p style="color: green; font-weight: bold;"> Done</p>
                  <button (click)="closeDigitizePopup()">Close</button>
                </div>}
              </div>
            </div>
            }
          </div>
          }

        </div>
      </div>
    </div>
  </div>
  @if(logsData){<div class="log-overlay">
    <div id="logCard" class="card shadow-lg border-0 rounded-3">


      <div class="card-header text-dark d-flex justify-content-between align-items-center">
        <span>üìÑ Request Logs</span>
        <div class="d-flex align-items-center gap-2">
          <span class="badge" [ngClass]="logsData.FinalStatusCode === 200 ? 'bg-success' : 'bg-danger'">
            {{ logsData.FinalStatusCode }}
          </span>
          <button class="close-btn btn btn-sm btn-danger" (click)="logsData = null">Close</button>
        </div>
      </div>

      <div class="card-body">

        <!-- Basic Info -->
        <h6 class="fw-bold mb-2">Basic Info</h6>
        <ul class="list-group mb-3">
          <li class="list-group-item"><b>Request ID:</b> {{ logsData.RequestId }}</li>
          <li class="list-group-item"><b>Timestamp:</b> {{ logsData.Timestamp | date:'dd MMMM yyyy, hh:mm:ssa'}}</li>

          <li class="list-group-item"><b>Message:</b> {{ logsData.Message }}</li>
          <li class="list-group-item"><b>File Name:</b> {{ logsData.PDFUpload_FileName }}</li>

          <li class="list-group-item">
            <b>File Size:</b> {{ (logsData.PDFUpload_FileSize_In_Bytes / (1024*1024)) | number:'1.2-2' }} MB
          </li>

          <li class="list-group-item"><b>Final Status Code:</b> {{ logsData.FinalStatusCode }}</li>
        </ul>

        <!-- Processing Stages -->
        <h6 class="fw-bold mb-2">Processing Stages</h6>


        <!-- PDF Upload -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.PDFUpload_StatusCode !== 200, 'border-success': logsData.PDFUpload_StatusCode  === 200}">
          <h6>üì§ PDF Upload</h6>
          <b>Status:</b> {{ logsData.PDFUpload_Status }} <br>
          <b>Code:</b> {{ logsData.PDFUpload_StatusCode }} <br>
          <b>File Size:</b> {{ logsData.PDFUpload_FileSize_In_Bytes / (1024*1024) | number:'1.2-2' }} MB
        </div>

        <!-- PDF Quality Check -->
        <!-- PDF Quality Check -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.PDFQualityCheck_StatusCode !== 200, 'border-success': logsData.PDFQualityCheck_StatusCode  === 200}">
          <h6>üßê PDF Quality Check</h6>
          <b>Status:</b> {{ logsData.PDFQualityCheck_Status }} <br>
          <b>Code:</b> {{ logsData.PDFQualityCheck_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.PDFQualityCheck_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds <br>
          <b>Blur Score:</b> {{ logsData.PDFQualityCheck_BlurScore | number:'1.0-2' }}
        </div>


        <!-- PDF Enhancement -->
        <!-- PDF Enhancement -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.PDFEnhancement_StatusCode !== 200,'border-success': logsData.PDFEnhancement_StatusCode  === 200}">
          <h6>‚ú® PDF Enhancement</h6>
          <b>Status:</b> {{ logsData.PDFEnhancement_Status }} <br>
          <b>Code:</b> {{ logsData.PDFEnhancement_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.PDFEnhancement_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- S3 Upload -->
        <!-- S3 Upload -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.S3Upload_StatusCode !== 200,'border-success': logsData.S3Upload_StatusCode === 200}">
          <h6>‚òÅÔ∏è S3 Upload</h6>
          <b>Status:</b> {{ logsData.S3Upload_Status }} <br>
          <b>Code:</b> {{ logsData.S3Upload_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.S3Upload_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- OCR -->
        <!-- OCR -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.OCR_StatusCode !== 200,'border-success': logsData.OCR_StatusCode === 200}">
          <h6>üîé OCR</h6>
          <b>Status:</b> {{ logsData.OCR_Status }} <br>
          <b>Code:</b> {{ logsData.OCR_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.OCR_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- LLM Postprocessing -->
        <!-- LLM Postprocessing -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.LLM_Postprocessing_StatusCode !== 200, 'border-success': logsData.LLM_Postprocessing_StatusCode === 200}">
          <h6>üõ†Ô∏è LLM Postprocessing</h6>
          <b>Status:</b> {{ logsData.LLM_Postprocessing_Status }} <br>
          <b>Code:</b> {{ logsData.LLM_Postprocessing_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.LLM_Postprocessing_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- LLM Confidence Scoring -->
        <!-- LLM Confidence Scoring -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.LLM_ConfidenceScoring_StatusCode !== 200, 'border-success': logsData.LLM_ConfidenceScoring_StatusCode === 200}">
          <h6>üìä LLM Confidence Scoring</h6>
          <b>Status:</b> {{ logsData.LLM_ConfidenceScoring_Status }} <br>
          <b>Code:</b> {{ logsData.LLM_ConfidenceScoring_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.LLM_ConfidenceScoring_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- LLM Validation -->
        <!-- LLM Validation -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.LLM_Validation_StatusCode !== 200, 'border-success': logsData.LLM_Validation_StatusCode === 200}">
          <h6>ü§ñ LLM Validation</h6>
          <b>Status:</b> {{ logsData.LLM_Validation_Status }} <br>
          <b>Code:</b> {{ logsData.LLM_Validation_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.LLM_Validation_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- Excel Generation -->
        <!-- Excel Generation -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.ExcelGeneration_StatusCode !== 200, 'border-success': logsData.ExcelGeneration_StatusCode === 200}">
          <h6>üìë Excel Generation</h6>
          <b>Status:</b> {{ logsData.ExcelGeneration_Status }} <br>
          <b>Code:</b> {{ logsData.ExcelGeneration_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.ExcelGeneration_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>


        <!-- Excel Storage -->
        <!-- Excel Storage -->
        <div class="card mb-2 p-3" [ngClass]="{'border-danger': logsData.ExcelStorage_StatusCode !== 200, 'border-success': logsData.ExcelStorage_StatusCode === 200}">
          <h6>üíæ Excel Storage</h6>
          <b>Status:</b> {{ logsData.ExcelStorage_Status }} <br>
          <b>Code:</b> {{ logsData.ExcelStorage_StatusCode }} <br>
          <b>Processing Time:</b> {{ logsData.ExcelStorage_ProcessingTimeMs / 1000 | number:'1.2-2' }} seconds
        </div>





        <!-- Extra Info -->
        <div class="mt-3">
          <p><b>Total Processing Time:</b> {{ (logsData.TotalProcessingTimeMs)/1000 | number:'1.2-2' }}
            seconds</p>

          <p><b>Retry Count:</b> {{ logsData.RetryCount }}</p>
          @if(logsData.ErrorCode && logsData.ErrorCode !== 'N/A')
          {<p><b>Error Code:</b> {{
            logsData.ErrorCode }}</p>
          }
          @if(logsData.ErrorMessage && logsData.ErrorMessage !== 'N/A'){<p><b> Message:</b> {{
            logsData.ErrorMessage }}</p>
          }
          @if(logsData.ErrorResolution && logsData.ErrorResolution !== 'N/A'){<p><b>Error Resolution:</b>
            {{ logsData.ErrorResolution }}</p>
          }
          @if(logsData.OriginalErrorMessage && logsData.OriginalErrorMessage !== ''){ <p><b>Original
              Error:</b> {{ logsData.OriginalErrorMessage }}</p>
          }
        </div>
      </div>
    </div>
  </div>
  }

</div>