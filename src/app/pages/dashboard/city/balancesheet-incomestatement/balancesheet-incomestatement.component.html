<!-- {{ selectedBtn() }}
{{ reportForm.get('reportType')?.value }}
{{ reportForm.get('valueType')?.value }}
{{ reportForm.get('currencyFormat')?.value }} -->
@if (this.yearsSignal().length === 0) {
  <app-no-data-found></app-no-data-found>
} @else {
  <section class="container">
    <!-- Buttons -->
    <app-tab-buttons
      [buttons]="buttons"
      (selectedButtonKeyChange)="onSelectedButtonChange($event)"
    ></app-tab-buttons>

    <!-- Filter -->
    <form
      [formGroup]="reportForm"
      class="d-flex align-items-center justify-content-between flex-wrap gap-2 border rounded bg-light p-4 my-4"
    >
      <!-- Report Type & Value Format -->
      @for (group of radioOptions; track $index) {
        <div class="min-width">
          <p class="fw-bold mb-2">{{ group.title }}</p>
          <div>
            @for (option of group.options; track option.key) {
              <input
                type="radio"
                [id]="option.key"
                [value]="option.key"
                [formControlName]="group.controlName"
                class="me-1"
              />
              <label [for]="option.key" class="me-3">{{ option.label }}</label>
            }
          </div>
        </div>
      }

      <!-- Currency Format Dropdown -->
      <div class="min-width">
        <label for="currencyFormat" class="d-block fw-bold mb-2">Display Numbers In</label>
        <select id="currencyFormat" formControlName="currencyFormat" class="form-select w-100">
          @for (format of currencyFormats; track format.key) {
            <option [value]="format.key">{{ format.label }}</option>
          }
        </select>
      </div>

      <!-- Search option -->
      <div class="min-width">
        <!-- <mat-form-field> -->
        <label for="filterInput" class="d-block fw-bold mb-2 form-label">Filter</label>
        <input
          id="filterInput"
          class="form-control w-100"
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Ex. Liabilities or Income"
          #input
          style="padding: 18px 8px"
        />
        <!-- </mat-form-field> -->
      </div>
    </form>
  </section>

  <!-- Table data. -->
  <div class="my-4 table-container">
    @if (isLoading) {
      <div class="custom-spinner-overlay position-absolute">
        <mat-spinner></mat-spinner>
      </div>
    }
    <table mat-table [dataSource]="filteredDataSource" class="mat-elevation-z8 border rounded">
      @for (item of headers; track $index) {
        <ng-container [matColumnDef]="item.key" [sticky]="$index === 0">
          <th mat-header-cell *matHeaderCellDef class="text-center fw-bold bg-table-header">
            {{ item.value }}
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [class]="item.class + ' ' + element.class"
            [ngClass]="element.isHeader ? 'bg-light' : ''"
          >
            <!-- {{ item.number }} -->
            <!-- {{ element | json }} -->
            <!-- {{ displayedColumns.length }} -->

            @if (item.number && !element['isHeader']) {
              {{
                getFormattedValue(element[item.key]) | inrFormat: currencyFormat : currencyOptions
              }}
            } @else {
              {{ element[item.key] }}
            }
            <!-- Add info icon -->
            @if (element.info && item.key === 'lineItem') {
              <i
                class="bi bi-info-circle"
                matTooltip="{{ element.info }}"
                matTooltipPosition="above"
              ></i>
            }
          </td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="fw-bold p-4 fs-5 text-center" [attr.colspan]="displayedColumns.length - 1">
          No results found for the applied filter.
        </td>
      </tr>
    </table>
  </div>

  <div class="text-end my-4">
    <i class="bi bi-file-earmark-pdf-fill text-danger"></i>
    <a [href]="fileLink" class="custom-font-size-6">
      How We Standardize Annual Financial Statements?
    </a>
  </div>

  <!-- Download report section -->
  <div class="my-4 overflow-x-auto">
    <table mat-table [dataSource]="downloadReportsDataSource" class="border">
      @for (item of downloadReportsHeaders; track $index) {
        <ng-container [matColumnDef]="item.key">
          <th mat-header-cell *matHeaderCellDef class="bg-table-header fw-bold text-center">
            {{ item.value }}
          </th>
          <td mat-cell *matCellDef="let element" [class]="item.class">
            @if (element[item.key] === 'pdf') {
              <button
                type="button"
                class="btn-icon"
                (click)="onFileClick('pdf', item.value)"
                aria-label="Open PDF"
              >
                <i class="bi bi-file-earmark-pdf-fill text-danger fs-4"></i>
              </button>
            } @else if (element[item.key] === 'excel') {
              <button
                type="button"
                class="btn-icon"
                (click)="onFileClick('excel', item.value)"
                aria-label="Open Excel"
              >
                <i class="bi bi-file-earmark-spreadsheet-fill text-success fs-4"></i>
              </button>
            } @else {
              {{ element[item.key] }}
            }
          </td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="downloadReportsDisplayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: downloadReportsDisplayedColumns"></tr>
    </table>
  </div>

  <!-- Note -->
  <p class="text-secondary my-4 custom-font-size-6">
    * PDF consists of final financial dataset as published by the ULB. Excel File contains
    standardised data from this raw PDF to enable comparison and analysis.
  </p>
}
